import{a as P}from"./chunk-7Y65TQUC.js";import{a as z}from"./chunk-OEY3IFP3.js";import{a as L}from"./chunk-VOEI7TUP.js";import{b as $,c as H,d as K}from"./chunk-YB6GNKOU.js";import"./chunk-JB324THB.js";import{Ca as n,Cc as Z,Fc as O,Ha as f,Ib as N,Ma as S,Na as I,Nb as m,Ob as g,Ra as c,T as k,U as C,W as x,Wa as r,cb as a,db as o,dc as U,eb as l,ec as F,fb as v,fc as G,gb as h,lb as d,oc as j,pc as y,sc as w,tc as D,wb as p,x as E,xb as _,ya as b,yb as B,zb as M}from"./chunk-VPSRVESD.js";import{a as A,b as R}from"./chunk-EQDQRRRY.js";var V=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=S({type:t,selectors:[["app-organization-chart"]],decls:1,vars:0,template:function(i,u){i&1&&l(0,"router-outlet")},dependencies:[O,Z],encapsulation:2})}}return t})();var Y=(()=>{class t{constructor(e,i,u){this.http=e,this.authService=i,this.connectionStatusService=u,this.roles=[{name:"Administrador",permissions:["crear","editar","eliminar","ver"],poder:4},{name:"M\xE9dico",permissions:["editar","ver"],poder:2},{name:"Enfermero",permissions:["ver"],poder:1}],this.connectionStatusService.initialize()}getRoles(){return this.roles}listUsers(){let e=new w({Authorization:"Bearer "+this.authService.token}),i=L+"/staffs";return this.http.get(i,{headers:e})}listConfig(){let e=new w({Authorization:"Bearer "+this.authService.token}),i=L+"/staffs/config";return this.http.get(i,{headers:e})}logout(){this.connectionStatusService.logout()}get isCurrentUserOnline(){return this.connectionStatusService.isCurrentlyOnline}get connectionStatus$(){return this.connectionStatusService.isOnline$}sendHeartbeat(){}setUserOffline(){this.connectionStatusService.logout()}stopHeartbeat(){}startHeartbeat(){}setupPageCloseDetection(){}static{this.\u0275fac=function(i){return new(i||t)(x(D),x(z),x(P))}}static{this.\u0275prov=k({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var q=()=>[];function ie(t,s){t&1&&(a(0,"div",10),p(1),m(2,"translate"),o()),t&2&&(n(),_(g(2,1,"ORGANIZATION.LIST_ORGANIZATION.LOADING")))}function ne(t,s){if(t&1&&l(0,"img",23),t&2){let e=d().$implicit;r("src",e.avatar,b)}}function re(t,s){if(t&1&&(v(0),a(1,"div",18)(2,"div",19),c(3,ne,1,1,"img",20),l(4,"span",21),m(5,"translate"),o(),a(6,"div",22),p(7),o()(),h()),t&2){let e=s.$implicit,i=d(2);n(3),r("ngIf",e.avatar),n(),r("ngClass",i.isOnline(e)?"online":"offline")("title",g(5,5,i.onlineTitleKey(e))),n(3),M("",e.name," ",e.surname,"")}}function oe(t,s){if(t&1&&l(0,"img",23),t&2){let e=d().$implicit;r("src",e.avatar,b)}}function ae(t,s){if(t&1&&(v(0),a(1,"div",18)(2,"div",19),c(3,oe,1,1,"img",20),l(4,"span",21),m(5,"translate"),o(),a(6,"div",22),p(7),o()(),h()),t&2){let e=s.$implicit,i=d(2);n(3),r("ngIf",e.avatar),n(),r("ngClass",i.isOnline(e)?"online":"offline")("title",g(5,5,i.onlineTitleKey(e))),n(3),M("",e.name," ",e.surname,"")}}function se(t,s){if(t&1&&l(0,"img",23),t&2){let e=d().$implicit;r("src",e.avatar,b)}}function ce(t,s){if(t&1&&(a(0,"div",18)(1,"div",19),c(2,se,1,1,"img",20),l(3,"span",21),m(4,"translate"),o(),a(5,"div",22),p(6),o()()),t&2){let e=s.$implicit,i=d(4);n(2),r("ngIf",e.avatar),n(),r("ngClass",i.isOnline(e)?"online":"offline")("title",g(4,5,i.onlineTitleKey(e))),n(3),M("",e.name," ",e.surname,"")}}function le(t,s){if(t&1&&(v(0),a(1,"div",12)(2,"div",13)(3,"h5",14),p(4),o()(),a(5,"div",15)(6,"div",16),c(7,ce,7,7,"div",24),o()()(),h()),t&2){let e=d().$implicit;n(4),_(e.key),n(3),r("ngForOf",e.value)}}function de(t,s){if(t&1&&(v(0),c(1,le,8,2,"ng-container",9),h()),t&2){let e=s.$implicit;n(),r("ngIf",e.key!=="Director General"&&e.key!=="Subdirector General")}}function pe(t,s){if(t&1&&(a(0,"div")(1,"div",11)(2,"div",12)(3,"div",13)(4,"h5",14),p(5),m(6,"translate"),o()(),a(7,"div",15)(8,"div",16),c(9,re,8,7,"ng-container",17)(10,ae,8,7,"ng-container",17),o()()(),c(11,de,2,1,"ng-container",17),m(12,"keyvalue"),o()()),t&2){let e=d();n(5),_(g(6,4,"ORGANIZATION.LIST_ORGANIZATION.DIRECTION")),n(4),r("ngForOf",e.rolesMap["Director General"]||N(8,q)),n(),r("ngForOf",e.rolesMap["Subdirector General"]||N(9,q)),n(),r("ngForOf",g(12,6,e.rolesMap))}}var J=(()=>{class t{constructor(e,i,u,W){this.organizationService=e,this.authService=i,this.connectionStatusService=u,this.translate=W,this.users=[],this.loading=!0,this.rolesMap={},this.isCurrentUserOnline=!1,this.selectedLang=localStorage.getItem("language")||"es",this.translate.use(this.selectedLang)}toggleLanguage(){this.selectedLang=this.selectedLang==="es"?"en":"es",this.translate.use(this.selectedLang),localStorage.setItem("language",this.selectedLang)}ngOnInit(){this.loadUsers(),this.pollingSubscription=E(1e4).subscribe(()=>this.loadUsers()),this.connectionSubscription=this.connectionStatusService.isOnline$.subscribe(e=>{this.isCurrentUserOnline=e})}ngOnDestroy(){this.pollingSubscription?.unsubscribe(),this.connectionSubscription?.unsubscribe()}loadUsers(){this.organizationService.listUsers().subscribe({next:e=>{this.users=e.users.map(i=>R(A({},i),{online:this.normalizeOnline(i)})),this.groupUsersByRole(),this.loading=!1},error:()=>{this.loading=!1}})}groupUsersByRole(){this.rolesMap={},this.users.forEach(e=>{e.roles.forEach(i=>{this.rolesMap[i.name]||(this.rolesMap[i.name]=[]),this.rolesMap[i.name].push(e)})})}normalizeOnline(e){if(e==null)return!1;if(typeof e.online=="boolean")return e.online;if(e.is_online!==void 0)return!!e.is_online;if(e.status&&typeof e.status=="string")return e.status.toLowerCase().includes("online");if(e.last_seen){let i=new Date(e.last_seen).getTime();if(!isNaN(i))return Date.now()-i<2*60*1e3}return!1}isOnline(e){return this.normalizeOnline(e)}onlineTitleKey(e){return this.isOnline(e)?"ORGANIZATION.LIST_ORGANIZATION.ONLINE":"ORGANIZATION.LIST_ORGANIZATION.OFFLINE"}logout(){this.connectionStatusService.logout()}getConnectionStatus(e){return this.isOnline(e)?"online":"offline"}getStatusClass(e){return this.isOnline(e)?"status-online":"status-offline"}static{this.\u0275fac=function(i){return new(i||t)(f(Y),f(z),f(P),f($))}}static{this.\u0275cmp=S({type:t,selectors:[["app-list-organization"]],decls:14,vars:8,consts:[[1,"page-wrapper"],[1,"content","list-staff"],[1,"page-header","mb-4"],[1,"row"],[1,"col-sm-12"],[1,"breadcrumb","bg-light","p-2","rounded"],[1,"breadcrumb-item"],[1,"breadcrumb-item","active"],["class","loading",4,"ngIf"],[4,"ngIf"],[1,"loading"],[1,"org-chart"],[1,"card","mb-4","shadow","border-0"],[1,"card-header","bg-primary","text-white"],[1,"mb-0"],[1,"card-body"],[1,"users-row"],[4,"ngFor","ngForOf"],[1,"user-card","position-relative"],[1,"avatar-wrapper"],["alt","avatar","class","avatar-large",3,"src",4,"ngIf"],[1,"status-dot",3,"ngClass","title"],[1,"user-name","mt-3","fw-semibold"],["alt","avatar",1,"avatar-large",3,"src"],["class","user-card position-relative",4,"ngFor","ngForOf"]],template:function(i,u){i&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"ol",5)(6,"li",6),p(7),m(8,"translate"),o(),a(9,"li",7),p(10),m(11,"translate"),o()()()()(),c(12,ie,3,3,"div",8)(13,pe,13,10,"div",9),o()()),i&2&&(n(7),B("",g(8,4,"ORGANIZATION.LIST_ORGANIZATION.BREADCRUMB")," > "),n(3),_(g(11,6,"ORGANIZATION.LIST_ORGANIZATION.BREADCRUMB_USERS_BY_ROLE")),n(2),r("ngIf",u.loading),n(),r("ngIf",!u.loading))},dependencies:[y,U,F,G,j,K,H],styles:[".org-chart[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.75rem}.role-section[_ngcontent-%COMP%]{border-radius:8px;overflow:hidden;background:transparent;border:1px solid transparent}.role-header[_ngcontent-%COMP%]{padding:.8rem 1.2rem;background:var(--user-border-color, #0b99ff);color:#fff;font-weight:700;font-size:1.05rem;border-top-left-radius:8px;border-top-right-radius:8px}.role-body[_ngcontent-%COMP%]{padding:1rem;background:var(--user-card-bg, #111827);border-bottom-left-radius:8px;border-bottom-right-radius:8px;box-shadow:0 4px 12px #0000003d inset}.users-row[_ngcontent-%COMP%]{display:flex;gap:1.25rem;flex-wrap:wrap}.user-card[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--user-card-bg, #ffffff) 96%,transparent);color:var(--user-card-text-color, #111827);border-radius:8px;padding:1.2rem 1.6rem;text-align:center;min-width:220px;box-shadow:0 8px 22px #00000024;position:relative;border:1px solid color-mix(in srgb,var(--user-border-color, #0B7285) 10%,transparent)}.user-name[_ngcontent-%COMP%]{font-weight:700;color:var(--user-card-text-color, #111827);margin-bottom:.35rem;font-size:1.05rem}.user-email[_ngcontent-%COMP%]{font-size:.97rem;color:color-mix(in srgb,var(--user-card-text-color, #111827) 72%,transparent)}.avatar-large[_ngcontent-%COMP%]{width:110px;height:110px;border-radius:50%;object-fit:cover;box-shadow:0 4px 10px #00000014;display:block;margin:0 auto .5rem}.avatar-wrapper[_ngcontent-%COMP%]{position:relative;display:flex;justify-content:center;align-items:center}.status-dot[_ngcontent-%COMP%]{position:absolute;top:12px;right:12px;width:20px;height:20px;border-radius:50%;border:4px solid var(--user-card-bg, #ffffff);box-shadow:0 0 0 3px var(--user-card-bg, #ffffff);z-index:2;background:#bbb;transition:background .12s ease}.status-dot.online[_ngcontent-%COMP%]{background:#44b700}.status-dot.offline[_ngcontent-%COMP%]{background:#e53935}.loading[_ngcontent-%COMP%]{text-align:center;font-size:1.1rem;color:var(--user-card-text-color, #fff)}.online[_ngcontent-%COMP%]{color:#22c55e}.offline[_ngcontent-%COMP%]{color:#ff4f4f}.dark-mode[_nghost-%COMP%]   .role-header[_ngcontent-%COMP%], .dark-mode   [_nghost-%COMP%]   .role-header[_ngcontent-%COMP%]{background:var(--user-border-color, #0B7285);color:#fff}.dark-mode[_nghost-%COMP%]   .role-body[_ngcontent-%COMP%], .dark-mode   [_nghost-%COMP%]   .role-body[_ngcontent-%COMP%]{background:var(--user-card-bg, #23221c)}.dark-mode[_nghost-%COMP%]   .user-card[_ngcontent-%COMP%], .dark-mode   [_nghost-%COMP%]   .user-card[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--user-card-bg, #23221c) 95%,transparent)!important;color:var(--user-card-text-color, #ffffff)!important;border-color:color-mix(in srgb,var(--user-border-color, #0B7285) 12%,transparent)!important;box-shadow:0 6px 20px #0009 inset}.dark-mode[_nghost-%COMP%]   .user-email[_ngcontent-%COMP%], .dark-mode   [_nghost-%COMP%]   .user-email[_ngcontent-%COMP%]{color:color-mix(in srgb,var(--user-card-text-color, #ffffff) 68%,transparent)!important}.dark-mode[_nghost-%COMP%]   .status-dot[_ngcontent-%COMP%], .dark-mode   [_nghost-%COMP%]   .status-dot[_ngcontent-%COMP%]{border-color:var(--user-card-bg, #23221c);box-shadow:0 0 0 3px var(--user-card-bg, #23221c)}"]})}}return t})();var me=[{path:"",component:V,children:[{path:"list-organization",component:J}]}],Q=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=I({type:t})}static{this.\u0275inj=C({imports:[O.forChild(me),O]})}}return t})();var Le=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=I({type:t})}static{this.\u0275inj=C({imports:[y,Q]})}}return t})();export{Le as OrganizationChartModule};
