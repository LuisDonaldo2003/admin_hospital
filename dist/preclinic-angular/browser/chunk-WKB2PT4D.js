import{a as E}from"./chunk-MK73G5EB.js";import{a as w}from"./chunk-VOEI7TUP.js";import{A as G,C as L,c as F,e as b,g as T,h as D,k as j,m as z,p as N,q as R,z as $}from"./chunk-BOVGGUWC.js";import"./chunk-UYUIDONG.js";import{Ca as s,Dc as I,Ha as h,Ma as M,Ra as x,Ua as O,Wa as d,ba as g,ca as u,cb as o,db as a,eb as m,ec as P,fc as S,ib as C,kb as _,lb as f,pc as V,tc as k,wb as l,xb as y,yb as v}from"./chunk-VPSRVESD.js";import"./chunk-EQDQRRRY.js";function A(n,p){if(n&1){let t=C();o(0,"input",25),_("input",function(e){let r=g(t).index,c=f();return u(c.autoFocusNext(e,r))})("keydown.backspace",function(e){let r=g(t).index,c=f();return u(c.autoFocusPrev(e,r))})("paste",function(e){g(t);let r=f();return u(r.handlePaste(e))}),a()}if(n&2){let t=p.$implicit,i=p.index;d("formControl",t),O("aria-label","D\xEDgito "+(i+1)+" del c\xF3digo")}}function q(n,p){if(n&1&&(o(0,"div",26),m(1,"i",27),l(2," El c\xF3digo expira en "),o(3,"strong"),l(4),a()()),n&2){let t=f();s(4),y(t.timerDisplay)}}function B(n,p){if(n&1){let t=C();o(0,"div",28),m(1,"i",29),l(2," El c\xF3digo ha expirado "),o(3,"button",30),_("click",function(){g(t);let e=f();return u(e.resendCode())}),m(4,"i",31),l(5," Reenviar c\xF3digo "),a()()}}function U(n,p){if(n&1&&(o(0,"div",32),m(1,"i",33),l(2),a()),n&2){let t=f();s(2),v(" ",t.errorMsg," ")}}function H(n,p){if(n&1&&(o(0,"div",34),m(1,"i",35),l(2),a()),n&2){let t=f();s(2),v(" ",t.successMsg," ")}}function Y(n,p){if(n&1&&(o(0,"div",36),m(1,"i",37),l(2),a()),n&2){let t=f();s(2),v(" ",t.resendSuccessMsg," ")}}function J(n,p){n&1&&(o(0,"span"),m(1,"i",38),l(2," Verificar c\xF3digo "),a())}function K(n,p){n&1&&(o(0,"span"),m(1,"i",39),l(2," Verificando... "),a())}function Q(n,p){if(n&1){let t=C();o(0,"a",40),_("click",function(e){g(t);let r=f();return e.preventDefault(),u(r.resendCode())}),l(1," \xBFNo recibiste el c\xF3digo? Reenviar "),a()}}var ae=(()=>{class n{constructor(t,i,e,r){this.fb=t,this.http=i,this.router=e,this.authService=r,this.codeControls=[],this.submitted=!1,this.loading=!1,this.successMsg="",this.errorMsg="",this.resendSuccessMsg="",this.countdown=300,this.timerDisplay="",this.timerExpired=!1}ngOnInit(){this.codeControls=Array.from({length:8},()=>new j("",[b.required,b.maxLength(1)])),this.form=this.fb.group({email:[localStorage.getItem("pending_email")||"",[b.required,b.email]],code:this.fb.group(this.codeControls.reduce((t,i,e)=>(t[`char${e}`]=i,t),{}))}),this.startCountdown()}startCountdown(){this.updateTimerDisplay(),this.interval=setInterval(()=>{this.countdown>0?(this.countdown--,this.updateTimerDisplay()):(this.timerExpired=!0,clearInterval(this.interval))},1e3)}updateTimerDisplay(){let t=Math.floor(this.countdown/60),i=this.countdown%60;this.timerDisplay=`${t}:${i.toString().padStart(2,"0")}`}getCodeValue(){return this.codeControls.map(t=>t.value).join("")}autoFocusNext(t,i){let e=t.target;if(e.value&&i<this.codeControls.length-1){let r=e.parentElement?.children[i+1];r&&r.focus()}}autoFocusPrev(t,i){let e=t.target;if(!e.value&&i>0){let r=e.parentElement?.children[i-1];r&&r.focus()}}handlePaste(t){t.preventDefault();let e=(t.clipboardData?.getData("text")||"").trim().replace(/\s+/g,"");for(let c=0;c<this.codeControls.length;c++)this.codeControls[c].setValue(e[c]||"");let r=this.codeControls.findIndex(c=>!c.value);if(r>=0){let c=t.target.parentElement?.querySelectorAll("input");c&&c[r]&&c[r].focus()}}resendCode(){let t=this.form.get("email")?.value;t&&this.http.post(`${w}/resend-code`,{email:t}).subscribe({next:i=>{this.resendSuccessMsg=i.message||"C\xF3digo reenviado.",this.countdown=300,this.timerExpired=!1,this.startCountdown()},error:i=>{this.errorMsg=i?.error?.message||"No se pudo reenviar el c\xF3digo."}})}onSubmit(){if(this.submitted=!0,this.errorMsg="",this.successMsg="",this.codeControls.some(e=>e.invalid)||this.timerExpired)return;this.loading=!0;let t=this.getCodeValue(),i={email:this.form.get("email")?.value,code:t};this.http.post(`${w}/verify-code`,i).subscribe({next:e=>{e.access_token&&this.authService.savelocalStorage(e),this.successMsg=e.message||"Verificaci\xF3n exitosa.",localStorage.removeItem("pending_email"),setTimeout(()=>{e.is_profile_complete?this.router.navigate(["/profile"]):this.router.navigate(["/complete-profile"])},1e3)},error:e=>{this.loading=!1,this.errorMsg=e?.error?.message||"C\xF3digo incorrecto o expirado."}})}static{this.\u0275fac=function(i){return new(i||n)(h(G),h(k),h(I),h(E))}}static{this.\u0275cmp=M({type:n,selectors:[["app-verify-code"]],decls:32,vars:12,consts:[[1,"auth-layout"],["aria-hidden","true",1,"side-visual"],[1,"image-frame"],["src","assets/img/login-02.png","alt","Fachada del hospital IMSS Bienestar"],["aria-labelledby","verifyTitle",1,"auth-col"],[1,"auth-panel"],["aria-label","Logo institucional",1,"brand"],["src","assets/img/login-logo.png","alt","Logo SISMEG"],["id","verifyTitle",1,"title"],[1,"subtitle"],["novalidate","",3,"ngSubmit","formGroup"],[1,"code-section"],[1,"code-label"],[1,"code-inputs"],["type","text","maxlength","1","class","code-box",3,"formControl","input","keydown.backspace","paste",4,"ngFor","ngForOf"],["class","timer-display",4,"ngIf"],["class","alert alert-warning",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],["class","alert alert-success",4,"ngIf"],["class","alert alert-info",4,"ngIf"],[1,"actions"],["type","submit",1,"btn","btn-primary","w-100",3,"disabled"],[4,"ngIf"],[1,"footer-links"],["href","#","class","muted",3,"click",4,"ngIf"],["type","text","maxlength","1",1,"code-box",3,"input","keydown.backspace","paste","formControl"],[1,"timer-display"],["aria-hidden","true",1,"feather","icon-clock"],[1,"alert","alert-warning"],["aria-hidden","true",1,"feather","icon-alert-triangle"],["type","button",1,"btn","btn-outline-secondary","btn-sm","mt-2",3,"click"],["aria-hidden","true",1,"feather","icon-refresh-cw"],[1,"alert","alert-danger"],["aria-hidden","true",1,"feather","icon-x-circle"],[1,"alert","alert-success"],["aria-hidden","true",1,"feather","icon-check-circle"],[1,"alert","alert-info"],["aria-hidden","true",1,"feather","icon-mail"],["aria-hidden","true",1,"feather","icon-shield-check"],["aria-hidden","true",1,"fa","fa-spinner","fa-spin"],["href","#",1,"muted",3,"click"]],template:function(i,e){if(i&1&&(o(0,"div",0)(1,"aside",1)(2,"div",2),m(3,"img",3),a()(),o(4,"main",4)(5,"section",5)(6,"div",6),m(7,"img",7),a(),o(8,"h1",8),l(9,"Verificar c\xF3digo"),a(),o(10,"p",9),l(11," Te enviamos un c\xF3digo de recuperaci\xF3n a"),m(12,"br"),o(13,"strong"),l(14),a()(),o(15,"form",10),_("ngSubmit",function(){return e.onSubmit()}),o(16,"div",11)(17,"label",12),l(18,"Ingresa el c\xF3digo de 8 d\xEDgitos"),a(),o(19,"div",13),x(20,A,1,2,"input",14),a()(),x(21,q,5,1,"div",15)(22,B,6,0,"div",16)(23,U,3,1,"div",17)(24,H,3,1,"div",18)(25,Y,3,1,"div",19),o(26,"div",20)(27,"button",21),x(28,J,3,0,"span",22)(29,K,3,0,"span",22),a()(),o(30,"div",23),x(31,Q,2,0,"a",24),a()()()()()),i&2){let r;s(14),y((r=e.form.get("email"))==null?null:r.value),s(),d("formGroup",e.form),s(5),d("ngForOf",e.codeControls),s(),d("ngIf",!e.timerExpired),s(),d("ngIf",e.timerExpired),s(),d("ngIf",e.errorMsg),s(),d("ngIf",e.successMsg),s(),d("ngIf",e.resendSuccessMsg),s(2),d("disabled",e.loading||e.timerExpired),s(),d("ngIf",!e.loading),s(),d("ngIf",e.loading),s(2),d("ngIf",!e.timerExpired)}},dependencies:[V,P,S,L,z,F,T,D,$,N,R],styles:['@charset "UTF-8";.auth-layout[_ngcontent-%COMP%]{min-height:100vh;display:grid;grid-template-columns:1.2fr 1fr;background:#0f1115;overflow-x:hidden}.side-visual[_ngcontent-%COMP%]{position:relative;overflow:hidden;border-radius:0 28px 28px 0;box-shadow:inset 0 0 0 1px #ffffff0a;max-width:100%}.image-frame[_ngcontent-%COMP%]{width:100%;height:100%;max-height:100vh}.side-visual[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:auto;max-height:100vh;max-width:100%;object-fit:cover;display:block;transform-origin:center}.auth-col[_ngcontent-%COMP%]{display:grid;place-items:center;padding:clamp(.6rem,2vw,1.6rem)}.auth-panel[_ngcontent-%COMP%]{width:min(520px,92vw);color:#0f172a;background:#fff;border-radius:22px;padding:clamp(.9rem,2.2vw,1.4rem) clamp(.9rem,2.2vw,1.4rem);box-shadow:0 10px 35px #0000002e,0 2px 8px #00000014;position:relative;display:flex;flex-direction:column;justify-content:center;gap:.6rem}.brand[_ngcontent-%COMP%]{width:clamp(120px,20vw,200px);height:clamp(120px,20vw,200px);display:grid;place-items:center;margin:0 auto 1rem;border-radius:50%;background:radial-gradient(120px 120px at 50% 50%,#fff 0,#f6f7ff 60%,#e9efff);box-shadow:0 8px 36px #3b82f62e;position:static;z-index:3}.brand[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:78%;height:auto;display:block;object-fit:contain;filter:drop-shadow(0 6px 18px rgba(46,55,164,.22))}.title[_ngcontent-%COMP%]{text-align:center;font-weight:800;font-size:clamp(1.45rem,2.2vw,1.9rem);margin:0 0 .25rem;color:#2e37a4}.subtitle[_ngcontent-%COMP%]{text-align:center;margin:0 0 1.25rem;color:#64748b;font-size:.95rem;line-height:1.4}.subtitle[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#2e37a4;font-weight:600}.code-section[_ngcontent-%COMP%]{margin:1.5rem 0}.code-label[_ngcontent-%COMP%]{display:block;text-align:center;font-weight:600;margin-bottom:1rem;color:#0f172a;font-size:.9rem}.code-inputs[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:.5rem;margin-bottom:1rem;flex-wrap:nowrap}.code-box[_ngcontent-%COMP%]{width:48px;height:58px;text-align:center;font-size:1.5rem;font-weight:600;border:2px solid #e5e7eb;border-radius:12px;background:#f9fafb;color:#0f172a;transition:all .18s ease;outline:none}.code-box[_ngcontent-%COMP%]:focus{border-color:#2e37a4;background:#fff;box-shadow:0 0 0 4px #2e37a426;transform:scale(1.05)}.code-box[_ngcontent-%COMP%]:valid{border-color:#10b981;background:#f0fdf4}.timer-display[_ngcontent-%COMP%]{text-align:center;padding:.75rem 1rem;background:linear-gradient(135deg,#f0f9ff,#e0f2fe);border:1px solid #7dd3fc;border-radius:12px;margin-bottom:1rem;font-size:.9rem;color:#0369a1}.timer-display[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:.5rem;color:#0284c7}.timer-display[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-weight:700;color:#0c4a6e}.btn[_ngcontent-%COMP%]{border:0;cursor:pointer;font-family:inherit;font-weight:700;letter-spacing:.15px;border-radius:12px;transition:all .18s ease;display:inline-flex;align-items:center;justify-content:center;gap:.5rem}.btn-primary[_ngcontent-%COMP%]{--c1: #2e37a4;--c2: #60a5fa;background:linear-gradient(90deg,var(--c1),var(--c2));color:#fff;padding:.95rem 1rem;box-shadow:0 8px 22px #3b82f62e}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-1px);filter:saturate(1.05);box-shadow:0 12px 28px #3b82f640}.btn-primary[_ngcontent-%COMP%]:disabled{opacity:.55;cursor:not-allowed;box-shadow:none;filter:grayscale(.1);transform:none}.btn-outline-secondary[_ngcontent-%COMP%]{background:transparent;color:#6b7280;border:1px solid #d1d5db;padding:.5rem 1rem}.btn-outline-secondary[_ngcontent-%COMP%]:hover{background:#f9fafb;border-color:#9ca3af}.btn-sm[_ngcontent-%COMP%]{padding:.4rem .8rem;font-size:.85rem}.w-100[_ngcontent-%COMP%]{width:100%}.actions[_ngcontent-%COMP%]{margin-top:.75rem}.alert[_ngcontent-%COMP%]{border-radius:12px;padding:.8rem 1rem;margin-bottom:1rem;font-size:.95rem;display:flex;align-items:center;gap:.5rem;line-height:1.4}.alert[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{flex-shrink:0}.alert-danger[_ngcontent-%COMP%]{background:#fee2e2;color:#7f1d1d;border:1px solid #fecaca}.alert-warning[_ngcontent-%COMP%]{background:#fff7ed;color:#7c2d12;border:1px solid #ffedd5;flex-direction:column;align-items:center;text-align:center}.alert-success[_ngcontent-%COMP%]{background:#f0fdf4;color:#14532d;border:1px solid #bbf7d0}.alert-info[_ngcontent-%COMP%]{background:#f0f9ff;color:#0c4a6e;border:1px solid #bae6fd}.footer-links[_ngcontent-%COMP%]{text-align:center;margin-top:1rem}.muted[_ngcontent-%COMP%]{color:#6b7280!important;font-size:.9rem;text-decoration:none;transition:color .18s ease}.muted[_ngcontent-%COMP%]:hover{color:#2e37a4!important;text-decoration:underline}@media (max-width: 1100px){.auth-layout[_ngcontent-%COMP%]{grid-template-columns:1fr}.side-visual[_ngcontent-%COMP%]{height:28vh;border-radius:0;box-shadow:none}}@media (max-width: 640px){.brand[_ngcontent-%COMP%]{width:140px;height:140px}.auth-panel[_ngcontent-%COMP%]{padding:1.25rem;border-radius:18px}.code-inputs[_ngcontent-%COMP%]{gap:.35rem}.code-box[_ngcontent-%COMP%]{width:42px;height:52px;font-size:1.3rem}}']})}}return n})();export{ae as VerifyCodeComponent};
