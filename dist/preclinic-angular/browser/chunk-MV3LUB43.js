import{a as S}from"./chunk-VOEI7TUP.js";import{a as i}from"./chunk-KOTFE7EF.js";import{Ac as m,B as c,T as u,W as a,d as l,n as s,q as n,qc as g}from"./chunk-6AUGAOY5.js";var j=(()=>{class r{constructor(e,o){this.router=e,this.http=o,this.userSubject=new l(null),this.user$=this.userSubject.asObservable(),this.getLocalStorage()}getLocalStorage(){if(localStorage.getItem("token")&&localStorage.getItem("user")){let e=localStorage.getItem("user");this.token=localStorage.getItem("token"),this.userSubject.next(JSON.parse(e||""))}else this.token=null,this.userSubject.next(null)}login(e,o){let h=S+"/auth/login";return this.http.post(h,{email:e,password:o}).pipe(n(t=>t&&t.access_token?(this.savelocalStorage(t),{success:!0}):{success:!1}),c(t=>(console.error("Login error:",t),t.status===403&&t.error?.unverified?(localStorage.setItem("pending_email",e),this.router.navigate(["/verify-code"]),s({success:!1,unverified:!0})):s({success:!1}))))}savelocalStorage(e){return e&&e.access_token?(localStorage.setItem("token",e.access_token),localStorage.setItem("user",JSON.stringify(e.user)),localStorage.setItem("authenticated","true"),this.userSubject.next(e.user),!0):!1}logout(){this.http.post("/api/auth/logout",{}).subscribe({next:()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("authenticated"),this.userSubject.next(null),this.router.navigate([i.login]).then(()=>{window.location.reload()})},error:()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("authenticated"),this.userSubject.next(null),this.router.navigate([i.login]).then(()=>{window.location.reload()})}})}get user(){return JSON.parse(localStorage.getItem("user")||"null")}static{this.\u0275fac=function(o){return new(o||r)(a(m),a(g))}}static{this.\u0275prov=u({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();export{j as a};
