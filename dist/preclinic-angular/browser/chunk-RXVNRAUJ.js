import{a as w}from"./chunk-VOEI7TUP.js";import{A as z,C as A,c as T,e as x,g as P,h as D,k as O,m as j,p as N,q as $,z as q}from"./chunk-BOVGGUWC.js";import{Bc as R,Ca as a,Dc as k,Fc as F,Ha as g,Ma as V,Ra as h,Wa as d,ba as u,ca as f,cb as r,db as c,eb as _,ec as M,fc as S,ib as v,kb as C,lb as p,pc as I,tc as E,wb as l,xb as b,yb as y}from"./chunk-VPSRVESD.js";import"./chunk-EQDQRRRY.js";function G(o,m){if(o&1){let t=v();r(0,"input",17),C("input",function(e){let n=u(t).index,s=p();return f(s.autoFocusNext(e,n))})("keydown.backspace",function(e){let n=u(t).index,s=p();return f(s.autoFocusPrev(e,n))})("paste",function(e){u(t);let n=p();return f(n.handlePaste(e))}),c()}if(o&2){let t=m.$implicit;d("formControl",t)}}function L(o,m){if(o&1&&(r(0,"div",18),l(1," El c\xF3digo expira en "),r(2,"b"),l(3),c()()),o&2){let t=p();a(3),b(t.timerDisplay)}}function U(o,m){if(o&1){let t=v();r(0,"div",19),l(1," El c\xF3digo ha expirado. "),_(2,"br"),r(3,"button",20),C("click",function(){u(t);let e=p();return f(e.resendCode())}),l(4,"Reenviar c\xF3digo"),c()()}}function B(o,m){if(o&1&&(r(0,"div",21),l(1),c()),o&2){let t=p();a(),y(" ",t.errorMsg," ")}}function H(o,m){if(o&1&&(r(0,"div",22),l(1),c()),o&2){let t=p();a(),y(" ",t.successMsg," ")}}function Q(o,m){o&1&&(r(0,"span"),l(1,"Verificar"),c())}function J(o,m){o&1&&(r(0,"span"),_(1,"i",23),l(2," Verificando..."),c())}var oe=(()=>{class o{constructor(t,i,e,n){this.fb=t,this.http=i,this.router=e,this.route=n,this.codeControls=[],this.submitted=!1,this.loading=!1,this.successMsg="",this.errorMsg="",this.resendSuccessMsg="",this.countdown=300,this.timerDisplay="",this.timerExpired=!1}ngOnInit(){let t=this.route.snapshot.queryParamMap.get("email")||"";localStorage.setItem("reset_email",t),this.codeControls=Array.from({length:8},()=>new O("",[x.required,x.maxLength(1)])),this.form=this.fb.group({email:[t,[x.required,x.email]],code:this.fb.group(this.codeControls.reduce((i,e,n)=>(i[`char${n}`]=e,i),{}))}),this.startCountdown()}startCountdown(){this.updateTimerDisplay(),this.interval=setInterval(()=>{this.countdown>0?(this.countdown--,this.updateTimerDisplay()):(this.timerExpired=!0,clearInterval(this.interval))},1e3)}updateTimerDisplay(){let t=Math.floor(this.countdown/60),i=this.countdown%60;this.timerDisplay=`${t}:${i.toString().padStart(2,"0")}`}getCodeValue(){return this.codeControls.map(t=>t.value).join("")}autoFocusNext(t,i){let e=t.target;if(e.value&&i<this.codeControls.length-1){let n=e.parentElement?.children[i+1];n&&n.focus()}}autoFocusPrev(t,i){let e=t.target;if(!e.value&&i>0){let n=e.parentElement?.children[i-1];n&&n.focus()}}handlePaste(t){t.preventDefault();let e=(t.clipboardData?.getData("text")||"").trim().replace(/\s+/g,"");for(let s=0;s<this.codeControls.length;s++)this.codeControls[s].setValue(e[s]||"");let n=this.codeControls.findIndex(s=>!s.value);if(n>=0){let s=t.target.parentElement?.querySelectorAll("input");s&&s[n]&&s[n].focus()}}resendCode(){let t=this.form.get("email")?.value;t&&this.http.post(`${w}/forgot-password/send-code`,{email:t}).subscribe({next:i=>{this.resendSuccessMsg=i.message||"C\xF3digo reenviado.",this.countdown=300,this.timerExpired=!1,this.startCountdown()},error:i=>{this.errorMsg=i?.error?.message||"No se pudo reenviar el c\xF3digo."}})}onSubmit(){if(this.submitted=!0,this.errorMsg="",this.successMsg="",this.codeControls.some(e=>e.invalid)||this.timerExpired)return;this.loading=!0;let t=this.getCodeValue(),i={email:this.form.get("email")?.value,code:t};this.http.post(`${w}/forgot-password/verify-code`,i).subscribe({next:e=>{this.successMsg=e.message||"C\xF3digo verificado. Redirigiendo...",setTimeout(()=>{this.router.navigate(["/reset-password"],{queryParams:{email:i.email,token:e.token||t}})},1e3)},error:e=>{this.loading=!1,this.errorMsg=e?.error?.message||"C\xF3digo incorrecto o expirado."}})}static{this.\u0275fac=function(i){return new(i||o)(g(z),g(E),g(k),g(R))}}static{this.\u0275cmp=V({type:o,selectors:[["app-verify-reset-code"]],decls:22,vars:10,consts:[[1,"background"],[1,"card-container"],[1,"text-center"],[1,"logo-wrapper","mb-3"],["src","assets/img/logo-hospital.png","alt","Logo",1,"logo-img"],[1,"title"],[1,"subtitle"],[3,"ngSubmit","formGroup"],[1,"code-inputs","mb-3"],["type","text","maxlength","1","class","code-box",3,"formControl","input","keydown.backspace","paste",4,"ngFor","ngForOf"],["class","text-center small text-muted mb-2",4,"ngIf"],["class","alert alert-warning p-2 small text-center",4,"ngIf"],["class","alert alert-danger text-center mt-2",4,"ngIf"],["class","alert alert-success text-center mt-2",4,"ngIf"],[1,"d-flex","justify-content-center"],[1,"btn","btn-primary","verify-btn","mt-3",3,"disabled"],[4,"ngIf"],["type","text","maxlength","1",1,"code-box",3,"input","keydown.backspace","paste","formControl"],[1,"text-center","small","text-muted","mb-2"],[1,"alert","alert-warning","p-2","small","text-center"],["type","button",1,"btn","btn-sm","btn-outline-secondary","mt-2",3,"click"],[1,"alert","alert-danger","text-center","mt-2"],[1,"alert","alert-success","text-center","mt-2"],[1,"fa","fa-spinner","fa-spin","me-2"]],template:function(i,e){if(i&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),_(4,"img",4),c(),r(5,"h2",5),l(6,"Verifica tu cuenta"),c(),r(7,"p",6),l(8," Te enviamos un c\xF3digo a "),r(9,"b"),l(10),c()()(),r(11,"form",7),C("ngSubmit",function(){return e.onSubmit()}),r(12,"div",8),h(13,G,1,1,"input",9),c(),h(14,L,4,1,"div",10)(15,U,5,0,"div",11)(16,B,2,1,"div",12)(17,H,2,1,"div",13),r(18,"div",14)(19,"button",15),h(20,Q,2,0,"span",16)(21,J,3,0,"span",16),c()()()()()),i&2){let n;a(10),b((n=e.form.get("email"))==null?null:n.value),a(),d("formGroup",e.form),a(2),d("ngForOf",e.codeControls),a(),d("ngIf",!e.timerExpired),a(),d("ngIf",e.timerExpired),a(),d("ngIf",e.errorMsg),a(),d("ngIf",e.successMsg),a(2),d("disabled",e.loading||e.timerExpired),a(),d("ngIf",!e.loading),a(),d("ngIf",e.loading)}},dependencies:[I,M,S,A,j,T,P,D,q,N,$,F],styles:['@charset "UTF-8";.background[_ngcontent-%COMP%]{background-color:#f4f2fc;min-height:100vh;display:flex;justify-content:center;align-items:center}.card-container[_ngcontent-%COMP%]{background:#fff;padding:60px 50px;border-radius:24px;box-shadow:0 10px 40px #0000001f;width:auto;min-width:550px;max-width:600px}.logo-wrapper[_ngcontent-%COMP%]{width:220px;height:220px;border:2px solid #3d3d3d;border-radius:50%;padding:15px;margin:0 auto;display:flex;justify-content:center;align-items:center}.logo-img[_ngcontent-%COMP%]{width:85%;height:85%;object-fit:contain}.title[_ngcontent-%COMP%]{font-weight:700;font-size:28px;margin-top:20px}.subtitle[_ngcontent-%COMP%]{font-size:16px;color:#666;margin-top:10px}.code-inputs[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:12px;margin-top:30px;padding:0;flex-wrap:nowrap;overflow:hidden}.code-box[_ngcontent-%COMP%]{width:50px;height:60px;text-align:center;font-size:28px;border:1px solid #ccc;border-radius:12px;transition:all .2s ease;background-color:#f9f9f9}.code-box[_ngcontent-%COMP%]:focus{border-color:#5c6ac4;box-shadow:0 0 12px #5c6ac499;outline:none}.verify-btn[_ngcontent-%COMP%]{background-color:#3b3dbf;border:none;padding:12px 50px;border-radius:12px;font-size:18px;margin-top:30px;width:auto}.verify-btn[_ngcontent-%COMP%]:hover{background-color:#2f31a2}']})}}return o})();export{oe as VerifyResetCodeComponent};
