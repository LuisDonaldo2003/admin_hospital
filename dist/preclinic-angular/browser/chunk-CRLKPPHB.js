import{a as O}from"./chunk-MV3LUB43.js";import{a as w}from"./chunk-VOEI7TUP.js";import"./chunk-KOTFE7EF.js";import{Ab as C,Ca as n,Cc as u,Ha as z,Ib as I,Ma as h,Na as x,Nb as R,Ob as j,Ra as c,T as P,U as v,W as S,Wa as o,cb as a,cc as k,db as r,dc as T,eb as m,ec as D,fb as d,gb as g,lb as p,lc as $,mc as b,pc as E,qc as N,x as U,xb as l,ya as _,yb as f,zc as A}from"./chunk-6AUGAOY5.js";import{a as F,b as L}from"./chunk-EQDQRRRY.js";var B=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=h({type:t,selectors:[["app-organization-chart"]],decls:1,vars:0,template:function(i,M){i&1&&m(0,"router-outlet")},dependencies:[u,A],encapsulation:2})}}return t})();var G=(()=>{class t{constructor(e,i){this.http=e,this.authService=i,this.roles=[{name:"Administrador",permissions:["crear","editar","eliminar","ver"],poder:4},{name:"M\xE9dico",permissions:["editar","ver"],poder:2},{name:"Enfermero",permissions:["ver"],poder:1}]}getRoles(){return this.roles}listUsers(){let e=new E({Authorization:"Bearer "+this.authService.token}),i=w+"/staffs";return this.http.get(i,{headers:e})}listConfig(){let e=new E({Authorization:"Bearer "+this.authService.token}),i=w+"/staffs/config";return this.http.get(i,{headers:e})}static{this.\u0275fac=function(i){return new(i||t)(S(N),S(O))}}static{this.\u0275prov=P({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var H=()=>[];function Q(t,s){t&1&&(a(0,"div",10),l(1,"Cargando..."),r())}function W(t,s){if(t&1&&m(0,"img",24),t&2){let e=p().$implicit;o("src",e.avatar,_)}}function X(t,s){if(t&1&&(d(0),a(1,"div",18)(2,"div",19),c(3,W,1,1,"img",20),m(4,"span",21),r(),a(5,"div",22),l(6),r(),a(7,"div",23),l(8),r()(),g()),t&2){let e=s.$implicit;n(3),o("ngIf",e.avatar),n(),o("ngClass",e.online===!0?"online":"offline")("title",e.online===!0?"Conectado":"Desconectado"),n(2),C("",e.name," ",e.surname,""),n(2),f(e.email)}}function Y(t,s){if(t&1&&m(0,"img",24),t&2){let e=p().$implicit;o("src",e.avatar,_)}}function Z(t,s){if(t&1&&(d(0),a(1,"div",18)(2,"div",19),c(3,Y,1,1,"img",20),m(4,"span",21),r(),a(5,"div",22),l(6),r(),a(7,"div",23),l(8),r()(),g()),t&2){let e=s.$implicit;n(3),o("ngIf",e.avatar),n(),o("ngClass",e.online===!0?"online":"offline")("title",e.online===!0?"Conectado":"Desconectado"),n(2),C("",e.name," ",e.surname,""),n(2),f(e.email)}}function ee(t,s){if(t&1&&m(0,"img",24),t&2){let e=p().$implicit;o("src",e.avatar,_)}}function te(t,s){if(t&1&&(a(0,"div",18)(1,"div",19),c(2,ee,1,1,"img",20),m(3,"span",21),r(),a(4,"div",22),l(5),r(),a(6,"div",23),l(7),r()()),t&2){let e=s.$implicit;n(2),o("ngIf",e.avatar),n(),o("ngClass",e.online===!0?"online":"offline")("title",e.online===!0?"Conectado":"Desconectado"),n(2),C("",e.name," ",e.surname,""),n(2),f(e.email)}}function ie(t,s){if(t&1&&(d(0),a(1,"div",12)(2,"div",13)(3,"h5",14),l(4),r()(),a(5,"div",15)(6,"div",16),c(7,te,8,6,"div",25),r()()(),g()),t&2){let e=p().$implicit;n(4),f(e.key),n(3),o("ngForOf",e.value)}}function ne(t,s){if(t&1&&(d(0),c(1,ie,8,2,"ng-container",9),g()),t&2){let e=s.$implicit;n(),o("ngIf",e.key!=="Director General"&&e.key!=="Subdirector General")}}function re(t,s){if(t&1&&(a(0,"div")(1,"div",11)(2,"div",12)(3,"div",13)(4,"h5",14),l(5,"Direcci\xF3n General"),r()(),a(6,"div",15)(7,"div",16),c(8,X,9,6,"ng-container",17)(9,Z,9,6,"ng-container",17),r()()(),c(10,ne,2,1,"ng-container",17),R(11,"keyvalue"),r()()),t&2){let e=p();n(8),o("ngForOf",e.rolesMap["Director General"]||I(5,H)),n(),o("ngForOf",e.rolesMap["Subdirector General"]||I(6,H)),n(),o("ngForOf",j(11,3,e.rolesMap))}}var V=(()=>{class t{constructor(e,i){this.organizationService=e,this.authService=i,this.users=[],this.loading=!0,this.rolesMap={}}ngOnInit(){this.loadUsers(),this.pollingSubscription=U(1e4).subscribe(()=>this.loadUsers())}ngOnDestroy(){this.pollingSubscription?.unsubscribe()}loadUsers(){this.organizationService.listUsers().subscribe({next:e=>{this.users=e.users.map(i=>L(F({},i),{online:i.online===!0})),this.groupUsersByRole(),this.loading=!1},error:()=>{this.loading=!1}})}groupUsersByRole(){this.rolesMap={},this.users.forEach(e=>{e.roles.forEach(i=>{this.rolesMap[i.name]||(this.rolesMap[i.name]=[]),this.rolesMap[i.name].push(e)})})}static{this.\u0275fac=function(i){return new(i||t)(z(G),z(O))}}static{this.\u0275cmp=h({type:t,selectors:[["app-list-organization"]],decls:12,vars:2,consts:[[1,"page-wrapper"],[1,"content","list-staff"],[1,"page-header","mb-4"],[1,"row"],[1,"col-sm-12"],[1,"breadcrumb","bg-light","p-2","rounded"],[1,"breadcrumb-item"],[1,"breadcrumb-item","active"],["class","loading",4,"ngIf"],[4,"ngIf"],[1,"loading"],[1,"org-chart"],[1,"card","mb-4","shadow","border-0"],[1,"card-header","bg-primary","text-white"],[1,"mb-0"],[1,"card-body"],[1,"users-row"],[4,"ngFor","ngForOf"],[1,"user-card","position-relative"],[1,"avatar-wrapper"],["alt","avatar","class","avatar-large",3,"src",4,"ngIf"],[1,"status-dot",3,"ngClass","title"],[1,"user-name","mt-3","fw-semibold"],[1,"user-email","text-muted","small"],["alt","avatar",1,"avatar-large",3,"src"],["class","user-card position-relative",4,"ngFor","ngForOf"]],template:function(i,M){i&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"ol",5)(6,"li",6),l(7,"Organigrama"),r(),a(8,"li",7),l(9,"Usuarios por Rol"),r()()()()(),c(10,Q,2,0,"div",8)(11,re,12,7,"div",9),r()()),i&2&&(n(10),o("ngIf",M.loading),n(),o("ngIf",!M.loading))},dependencies:[b,k,T,D,$],styles:[".org-chart[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem}.role-title[_ngcontent-%COMP%]{font-weight:700;font-size:1.2rem;margin-bottom:.5rem}.users-row[_ngcontent-%COMP%]{display:flex;gap:1rem;flex-wrap:wrap}.user-card[_ngcontent-%COMP%]{background:#f5f5f5;border-radius:8px;padding:1rem;text-align:center;min-width:150px;box-shadow:0 2px 8px #0000000d}.avatar-large[_ngcontent-%COMP%]{width:120px;height:120px;border-radius:50%;object-fit:cover;box-shadow:0 2px 8px #00000014}.avatar-wrapper[_ngcontent-%COMP%]{position:relative;display:flex;justify-content:center;align-items:center}.status-dot[_ngcontent-%COMP%]{position:absolute;top:8px;right:8px;width:28px;height:28px;border-radius:50%;border:4px solid #fff;box-shadow:0 0 0 2px #fff;z-index:2;background:#bbb;transition:background .2s}.status-dot.online[_ngcontent-%COMP%]{background:#44b700}.status-dot.offline[_ngcontent-%COMP%]{background:#e53935}.loading[_ngcontent-%COMP%]{text-align:center;font-size:1.2rem}.online[_ngcontent-%COMP%]{color:#22c55e}.offline[_ngcontent-%COMP%]{color:#ff4f4f}"]})}}return t})();var oe=[{path:"",component:B,children:[{path:"list-organization",component:V}]}],K=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=x({type:t})}static{this.\u0275inj=v({imports:[u.forChild(oe),u]})}}return t})();var ye=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=x({type:t})}static{this.\u0275inj=v({imports:[b,K]})}}return t})();export{ye as OrganizationChartModule};
