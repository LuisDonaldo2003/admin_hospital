<div class="page-wrapper" *ngIf="!loading; else loadingTpl">
  <div class="content archive-dash-new">
    <!-- Breadcrumb -->
    <ul class="breadcrumb mb-3">
      <li class="breadcrumb-item "><a>{{ 'DASHBOARD.DASHBOARD_ARCHIVE.DASHBOARD' | translate }} ></a></li>
      <li class="breadcrumb-item active">{{ 'DASHBOARD.DASHBOARD_ARCHIVE.ARCHIVE' | translate }}</li>
    </ul>

    <!-- Hero -->
    <section class="hero mb-4">
      <div class="hero-inner">
        <div class="hero-text">
          <h1><span>{{ 'DASHBOARD.DASHBOARD_ARCHIVE.ARCHIVE' | translate }}</span> | {{ 'DASHBOARD.DASHBOARD_ARCHIVE.SUMMARY' | translate }}</h1>
          <p>{{ 'DASHBOARD.DASHBOARD_ARCHIVE.VISION' | translate }}</p>
        </div>
        <div class="hero-meta">
          <button class="btn btn-refresh" (click)="loadStats()"><i class="fa fa-rotate"></i></button>
        </div>
      </div>
      <div class="hero-bg"></div>
    </section>

    <!-- KPIs -->
    <section class="kpi-grid mb-4">
      <div class="kpi-card" *ngFor="let k of [
        {t:('DASHBOARD.DASHBOARD_ARCHIVE.TODAY' | translate), s:('DASHBOARD.DASHBOARD_ARCHIVE.REGISTER' | translate), v: stats.todayAdded, ic:'fa-calendar-day'},
        {t:('DASHBOARD.DASHBOARD_ARCHIVE.WEEK' | translate), s:('DASHBOARD.DASHBOARD_ARCHIVE.ACCUMULATED' | translate), v: stats.weekAdded, ic:'fa-layer-group'},
        {t:('DASHBOARD.DASHBOARD_ARCHIVE.MONTH' | translate), s:('DASHBOARD.DASHBOARD_ARCHIVE.ACCUMULATED' | translate), v: stats.monthAdded, ic:'fa-chart-column'},
        {t:('DASHBOARD.DASHBOARD_ARCHIVE.TOTAL' | translate), s:('DASHBOARD.DASHBOARD_ARCHIVE.HISTORICAL' | translate), v: stats.totalArchives, ic:'fa-database'}
      ]">
        <div class="kpi-icon"><i class="fa" [ngClass]="k.ic"></i></div>
        <div class="kpi-body">
          <div class="kpi-label">{{k.t}} <small>{{k.s}}</small></div>
          <div class="kpi-value">{{k.v}}</div>
        </div>
      </div>
    </section>

    <div class="grid-panels mb-4">
      <!-- Género -->
      <div class="panel panel-gender">
        <header class="panel-hd"><h3>{{ 'DASHBOARD.DASHBOARD_ARCHIVE.DISTRIBUTION_BY_GENDER' | translate }}</h3></header>
        <div class="gender-wrap" *ngIf="(byGender.male + byGender.female) > 0; else noGender">
          <div class="gender-bars">
            <div class="bar" aria-label="Masculino" [style.width]="(byGender.male/(byGender.male+byGender.female))*100 + '%'" ></div>
            <div class="bar female" aria-label="Femenino" [style.width]="(byGender.female/(byGender.male+byGender.female))*100 + '%'" ></div>
          </div>
          <ul class="legend">
            <li><span class="dot male"></span> {{ 'DASHBOARD.DASHBOARD_ARCHIVE.MAN' | translate }}: {{byGender.male}}</li>
            <li><span class="dot female"></span> {{ 'DASHBOARD.DASHBOARD_ARCHIVE.WOMAN' | translate }}: {{byGender.female}}</li>
          </ul>
        </div>
        <ng-template #noGender><div class="empty">{{ 'DASHBOARD.DASHBOARD_ARCHIVE.NOT_DATES' | translate }}</div></ng-template>
      </div>

      <!-- Ubicaciones -->
      <div class="panel panel-locations">
        <header class="panel-hd"><h3>{{ 'DASHBOARD.DASHBOARD_ARCHIVE.TOP_LOCATIONS' | translate }}</h3></header>
        <div *ngIf="byState.length; else noLocations" class="locations-list">
          <div *ngFor="let l of byState; let i = index" class="loc-item">
            <div class="loc-rank">{{i+1}}</div>
            <div class="loc-body">
              <div class="loc-name" [title]="l.state">{{l.state}}</div>
              <div class="loc-meter"><span class="meter-fill" [style.width]="(l.count / byState[0].count)*100 + '%'" ></span></div>
            </div>
            <div class="loc-count">{{l.count}}</div>
          </div>
        </div>
        <ng-template #noLocations><div class="empty">{{ 'DASHBOARD.DASHBOARD_ARCHIVE.NOT_REGISTERS' | translate }}</div></ng-template>
      </div>

      <!-- Acciones -->
  <div class="panel actions panel-actions">
        <header class="panel-hd"><h3>{{ 'DASHBOARD.DASHBOARD_ARCHIVE.ACTIONS' | translate }}</h3></header>
        <div class="actions-grid">
          <button class="action" routerLink='/archives/add_archive'><i class="fa fa-plus"></i><span>{{ 'DASHBOARD.DASHBOARD_ARCHIVE.NEW' | translate }}</span></button>
          <button class="action" routerLink='/archives/list_archive'><i class="fa fa-list"></i><span>{{ 'DASHBOARD.DASHBOARD_ARCHIVE.LIST' | translate }}</span></button>
          <button class="action" routerLink='/archives/export_archive'><i class="fa fa-file-export"></i><span>{{ 'DASHBOARD.DASHBOARD_ARCHIVE.EXPORT' | translate }}</span></button>
          <button class="action" routerLink='/archives/backup_archive'><i class="fa fa-database"></i><span>{{ 'DASHBOARD.DASHBOARD_ARCHIVE.BACKUP' | translate }}</span></button>
        </div>
      </div>
    </div>

  <!-- (Sección de gráfico eliminada a petición del usuario) -->
  <!-- Gráfico últimos 7 días -->
  <section class="weekly-chart" *ngIf="weeklyChart">
    <div class="panel panel-chart">
      <header class="panel-hd"><h3>{{ 'DASHBOARD.DASHBOARD_ARCHIVE.RECENT_REGISTERS' | translate }}</h3></header>
      <div class="chart-wrapper">
        <apx-chart
          *ngIf="weeklyChart"
          [series]="weeklyChart.series"
          [chart]="weeklyChart.chart"
          [xaxis]="weeklyChart.xaxis"
          [yaxis]="weeklyChart.yaxis"
          [dataLabels]="weeklyChart.dataLabels"
          [stroke]="weeklyChart.stroke"
          [grid]="weeklyChart.grid"
          [tooltip]="weeklyChart.tooltip"
          [fill]="weeklyChart.fill"
        ></apx-chart>
      </div>
    </div>
  </section>

    <div *ngIf="error" class="alert alert-danger py-2 px-3 small mb-0">{{error}}</div>
  </div>
</div>

<ng-template #loadingTpl>
  <div class="page-wrapper"><div class="content"><div class="text-center py-5 text-muted">{{ 'DASHBOARD.DASHBOARD_ARCHIVE.STATISTICS_LOADING' | translate }}</div></div></div>
</ng-template>
