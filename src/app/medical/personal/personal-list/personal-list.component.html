<!--
  Contenedor principal de la página de listado de personal
-->
<div class="page-wrapper">
  <div class="content list-personal">

    <!-- Encabezado de la página con breadcrumb de navegación -->
    <div class="page-header mb-3">
      <div class="row">
        <div class="col-sm-12">
          <!-- Breadcrumb compacto -->
          <ol class="breadcrumb p-2 rounded">
            <li class="breadcrumb-item">
              {{ 'PERSONAL.LIST_PERSONAL.BREADCRUMB_PERSONAL' | translate }}
              <span>></span>
            </li>
            <li class="breadcrumb-item active">{{ 'PERSONAL.LIST_PERSONAL.BREADCRUMB_LIST' | translate }}</li>
          </ol>
        </div>
      </div>
    </div>

    <!-- Sección principal del contenido -->
    <div class="row">
      <div class="col-sm-12">
        <div class="card card-list shadow border-0">
          <div class="card-body">

            <!-- Barra de acciones y búsqueda sobre la tabla -->
            <div class="d-flex justify-content-between align-items-center flex-wrap mb-3 header-bar">
              <!-- Título de la tabla -->
              <h4 class="mb-0 fw-semibold">{{ 'PERSONAL.LIST_PERSONAL.TITLE' | translate }}</h4>
              <div class="d-flex align-items-center gap-2 flex-wrap">
                <!-- Input de búsqueda -->
                <div class="input-group search-input">
                  <input type="text" 
                         class="form-control" 
                         placeholder="{{ 'PERSONAL.LIST_PERSONAL.SEARCH_PLACEHOLDER' | translate }}"
                         [(ngModel)]="searchDataValue" 
                         (ngModelChange)="searchData(searchDataValue)">
                  <span class="input-group-text">
                    <i class="fa fa-search"></i>
                  </span>
                </div>
                <!-- Botón para agregar nuevo personal -->
                <a routerLink="/personal/add_personal" class="btn btn-options d-flex align-items-center gap-1">
                  <i class="fa fa-plus"></i> <span class="d-none d-sm-inline">{{ 'PERSONAL.LIST_PERSONAL.NEW_PERSONAL' | translate }}</span>
                </a>
              </div>
            </div>

            <!-- Filtros adicionales -->
            <div class="row g-2 mb-3">
              <div class="col-lg-4">
                <label class="form-label">{{ 'PERSONAL.LIST_PERSONAL.FILTER_TYPE' | translate }}</label>
                <select class="form-select" 
                        [(ngModel)]="filtroTipo"
                        (change)="filterData()">
                  <option value="">{{ 'PERSONAL.LIST_PERSONAL.ALL_TYPES' | translate }}</option>
                  <option value="Clínico">{{ 'PERSONAL.LIST_PERSONAL.CLINICAL' | translate }}</option>
                  <option value="No Clínico">{{ 'PERSONAL.LIST_PERSONAL.NON_CLINICAL' | translate }}</option>
                </select>
              </div>
              <div class="col-lg-4">
                <label class="form-label">{{ 'PERSONAL.LIST_PERSONAL.DOCUMENT_STATUS' | translate }}</label>
                <select class="form-select" 
                        [(ngModel)]="filtroDocumentos"
                        (change)="filterData()">
                  <option value="">{{ 'PERSONAL.LIST_PERSONAL.ALL_STATUS' | translate }}</option>
                  <option value="completos">{{ 'PERSONAL.LIST_PERSONAL.COMPLETE_DOCUMENTS' | translate }}</option>
                  <option value="incompletos">{{ 'PERSONAL.LIST_PERSONAL.INCOMPLETE_DOCUMENTS' | translate }}</option>
                </select>
              </div>
              <div class="col-lg-4">
                <label class="form-label">{{ 'PERSONAL.LIST_PERSONAL.STATUS' | translate }}</label>
                <select class="form-select" 
                        [(ngModel)]="filtroActivo"
                        (change)="filterData()">
                  <option value="true">{{ 'PERSONAL.LIST_PERSONAL.ONLY_ACTIVE' | translate }}</option>
                  <option value="">{{ 'PERSONAL.LIST_PERSONAL.ALL_STATUS' | translate }}</option>
                  <option value="false">{{ 'PERSONAL.LIST_PERSONAL.ONLY_INACTIVE' | translate }}</option>
                </select>
              </div>
            </div>

            <!-- Diseño de cards moderno -->
            <div class="personnel-grid" *ngIf="personalList.length > 0">
              <div class="personnel-card" *ngFor="let personal of personalList">
                <!-- Encabezado de la card -->
                <div class="personnel-card-header">
                  <div class="name-section">
                    <i class="fa" 
                       [ngClass]="{
                         'fa-user-md': personal.tipo === 'Clínico',
                         'fa-user': personal.tipo === 'No Clínico'
                       }"></i>
                    <span class="personnel-name">{{ personal.nombre }} {{ personal.apellidos }}</span>
                  </div>
                  
                  <!-- Si tiene al menos un permiso (ver docs, editar, eliminar o toggle) -->
                  <div class="action-buttons-compact" *ngIf="canEditPersonal() || canDeletePersonal() || canViewDocuments() || canToggleStatus()">
                    <!-- Botón Ver Documentos - solo si tiene permiso -->
                    <button 
                      *ngIf="canViewDocuments() && personal.id"
                      class="btn-icon btn-docs" 
                      (click)="verDocumentos(personal.id)" 
                      title="Ver documentos">
                      <i class="fa fa-file-pdf"></i>
                    </button>
                    <!-- Botón Editar - solo si tiene permiso -->
                    <button 
                      *ngIf="canEditPersonal() && personal.id"
                      class="btn-icon btn-edit" 
                      [routerLink]="['/personal/edit_personal', personal.id]"
                      title="Editar">
                      <i class="fa fa-pen"></i>
                    </button>
                    <!-- Botón Toggle Estado - solo si tiene permiso -->
                    <button 
                      *ngIf="canToggleStatus()"
                      class="btn-icon btn-toggle" 
                      [ngClass]="{'inactive': !personal.activo}"
                      (click)="toggleEstado(personal)"
                      [title]="personal.activo ? 'Desactivar' : 'Activar'">
                      <i class="fa" [ngClass]="{'fa-eye-slash': personal.activo, 'fa-eye': !personal.activo}"></i>
                    </button>
                    <!-- Botón Eliminar - solo si tiene permiso -->
                    <button 
                      *ngIf="canDeletePersonal()"
                      class="btn-icon btn-delete"
                      (click)="selectPersonal(personal)"
                      data-bs-toggle="modal"
                      data-bs-target="#deleteModal"
                      title="Eliminar">
                      <i class="fa fa-trash"></i>
                    </button>
                  </div>
                  
                  <!-- Si no tiene ningún permiso -->
                  <span class="badge badge-no-permission" *ngIf="!canEditPersonal() && !canDeletePersonal() && !canViewDocuments() && !canToggleStatus()">
                    <i class="fa fa-ban me-1"></i>Sin permisos
                  </span>
                </div>

                <!-- Cuerpo de la card -->
                <div class="personnel-card-body">
                  <div class="personnel-horizontal-info">
                    <!-- RFC -->
                    <div class="info-block">
                      <i class="fa fa-id-card"></i>
                      <div class="info-details">
                        <span class="info-label-small">RFC</span>
                        <span class="info-value-main">{{ personal.rfc || 'N/A' }}</span>
                      </div>
                    </div>

                    <!-- Número de Checador -->
                    <div class="info-block">
                      <i class="fa fa-hashtag"></i>
                      <div class="info-details">
                        <span class="info-label-small">No. Checador</span>
                        <span class="info-value-main">{{ personal.numero_checador || 'N/A' }}</span>
                      </div>
                    </div>

                    <!-- Tipo de Personal -->
                    <div class="badge-type" 
                         [ngClass]="{
                           'badge-clinical': personal.tipo === 'Clínico',
                           'badge-non-clinical': personal.tipo === 'No Clínico'
                         }">
                      <i class="fa" [ngClass]="{'fa-stethoscope': personal.tipo === 'Clínico', 'fa-briefcase': personal.tipo === 'No Clínico'}"></i>
                      <span>{{ personal.tipo }}</span>
                    </div>

                    <!-- Fecha de Ingreso -->
                    <div class="info-block">
                      <i class="fa fa-calendar"></i>
                      <div class="info-details">
                        <span class="info-label-small">Fecha Ingreso</span>
                        <span class="info-value-main">{{ personal.fecha_ingreso | date:'dd/MM/yyyy' }}</span>
                      </div>
                    </div>

                    <!-- Estado de Documentos -->
                    <div class="badge-status" 
                         [ngClass]="{
                           'badge-complete': personal.documentos_completos,
                           'badge-incomplete': !personal.documentos_completos
                         }">
                      <i class="fa" [ngClass]="{'fa-check-circle': personal.documentos_completos, 'fa-exclamation-triangle': !personal.documentos_completos}"></i>
                      <span>{{ personal.documentos_completos ? ('PERSONAL.LIST_PERSONAL.COMPLETE' | translate) : ('PERSONAL.LIST_PERSONAL.INCOMPLETE' | translate) }}</span>
                    </div>

                    <!-- Estado Activo/Inactivo -->
                    <div class="badge-active" 
                         [ngClass]="{
                           'is-active': personal.activo,
                           'is-inactive': !personal.activo
                         }">
                      <i class="fa" [ngClass]="{'fa-check': personal.activo, 'fa-ban': !personal.activo}"></i>
                      <span>{{ personal.activo ? ('PERSONAL.LIST_PERSONAL.ACTIVE' | translate) : ('PERSONAL.LIST_PERSONAL.INACTIVE' | translate) }}</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Mensaje cuando no hay registros -->
            <div class="empty-state text-center" *ngIf="personalList.length === 0">
              <div class="empty-icon mb-3">
                <i class="fa fa-users fa-4x text-muted"></i>
              </div>
              <h5 class="text-muted">{{ 'PERSONAL.LIST_PERSONAL.NO_RECORDS_FOUND' | translate }}</h5>
              <p class="text-muted">{{ 'PERSONAL.LIST_PERSONAL.NO_MATCHING_CRITERIA' | translate }}</p>
              <a routerLink="/personal/add_personal" class="btn btn-options">
                <i class="fa fa-plus me-2"></i>{{ 'PERSONAL.LIST_PERSONAL.ADD_FIRST_PERSONNEL' | translate }}
              </a>
            </div>

            <!-- Sección de paginación -->
            <div class="d-flex justify-content-between align-items-center mt-3 flex-wrap pagination-wrapper" *ngIf="personalList.length > 0">
              <div class="pagination-info small">
                <i class="fa fa-info-circle me-1"></i>
                {{ 'PERSONAL.LIST_PERSONAL.SHOWING' | translate }} {{ serialNumberArray[0] }} {{ 'PERSONAL.LIST_PERSONAL.TO' | translate }} {{ serialNumberArray[serialNumberArray.length - 1] }} {{ 'PERSONAL.LIST_PERSONAL.OF' | translate }} {{ totalData }} {{ 'PERSONAL.LIST_PERSONAL.RECORDS' | translate }}
              </div>
              <nav>
                <ul class="pagination mb-0">
                  <li class="page-item" [class.disabled]="currentPage === 1">
                    <a class="page-link" href="javascript:void(0);" (click)="getMoreData('previous')">
                      <i class="fa fa-chevron-left"></i>
                    </a>
                  </li>
                  <ng-container *ngFor="let item of pageNumberArray">
                    <li class="page-item" [class.active]="item === currentPage">
                      <a class="page-link" href="javascript:void(0);" (click)="moveToPage(item)">{{ item }}</a>
                    </li>
                  </ng-container>
                  <li class="page-item" [class.disabled]="currentPage === pageNumberArray[pageNumberArray.length - 1]">
                    <a class="page-link" href="javascript:void(0);" (click)="getMoreData('next')">
                      <i class="fa fa-chevron-right"></i>
                    </a>
                  </li>
                </ul>
              </nav>
            </div>

            <!-- Estadísticas resumen (solo si hay datos) -->
            <div class="row mt-3" *ngIf="personalList.length > 0">
              <div class="col-12">
                <div class="alert alert-info border-0">
                  <div class="row text-center">
                    <div class="col-md-3">
                      <div class="stat-item">
                        <h5 class="text-primary mb-0">{{ totalData }}</h5>
                        <small>{{ 'PERSONAL.LIST_PERSONAL.TOTAL_PERSONNEL' | translate }}</small>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="stat-item">
                        <h5 class="text-success mb-0">{{ stats.clinico || 0 }}</h5>
                        <small>{{ 'PERSONAL.LIST_PERSONAL.CLINICAL_PERSONNEL' | translate }}</small>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="stat-item">
                        <h5 class="text-info mb-0">{{ stats.no_clinico || 0 }}</h5>
                        <small>{{ 'PERSONAL.LIST_PERSONAL.NON_CLINICAL_PERSONNEL' | translate }}</small>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="stat-item">
                        <h5 class="text-warning mb-0">{{ stats.documentos_completos || 0 }}</h5>
                        <small>{{ 'PERSONAL.LIST_PERSONAL.COMPLETE_DOCUMENTS_COUNT' | translate }}</small>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal de confirmación para eliminar personal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body text-center p-4">
        <!-- Imagen de advertencia -->
        <img src="assets/img/sent.png" alt="" width="50" height="46" />
        <!-- Mensaje de confirmación para eliminar personal -->
        <h5 class="mt-3" *ngIf="personal_selected">
          ¿Está seguro de eliminar al personal <strong>{{ personal_selected.nombre }} {{ personal_selected.apellidos }}</strong>?
        </h5>
        <p class="text-muted mt-2">Esta acción no se puede deshacer. Se eliminarán también todos los documentos asociados.</p>
        <div class="mt-4 d-flex justify-content-center gap-3">
          <!-- Botón para cancelar la eliminación -->
          <button class="btn btn-light" data-bs-dismiss="modal">Cancelar</button>
          <!-- Botón para confirmar la eliminación -->
          <button class="btn btn-danger" (click)="deletePersonal()" data-bs-dismiss="modal">Eliminar</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal para mostrar documentos -->
<div class="modal fade" id="documentsModal" tabindex="-1" aria-labelledby="documentsModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="documentsModalLabel">{{ 'PERSONAL.LIST_PERSONAL.PERSONNEL_DOCUMENTS' | translate }}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" *ngIf="selectedPersonalDocuments">
        <h6 class="mb-3">{{ selectedPersonalName }}</h6>
        <div class="row g-3">
          <div class="col-md-6" *ngFor="let doc of selectedPersonalDocuments">
            <div class="card">
              <div class="card-body text-center">
                <i class="fa fa-file-pdf fa-2x text-danger mb-2"></i>
                <h6 class="card-title">{{ doc.tipo_documento }}</h6>
                <p class="card-text small">{{ doc.nombre_archivo }}</p>
                <button class="btn btn-sm btn-outline-primary" (click)="downloadDocument(doc.id)">
                  <i class="fa fa-download me-1"></i> {{ 'PERSONAL.LIST_PERSONAL.DOWNLOAD' | translate }}
                </button>
              </div>
            </div>
          </div>
          <div class="col-12" *ngIf="selectedPersonalDocuments.length === 0">
            <div class="text-center text-muted py-4">
              <i class="fa fa-file-o fa-3x mb-3"></i>
              <p>{{ 'PERSONAL.LIST_PERSONAL.NO_DOCUMENTS_AVAILABLE' | translate }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
