<div class="page-wrapper">
  <div class="content list-staff">
    <div class="page-header mb-4">
      <div class="row">
        <div class="col-sm-12">
          <ol class="breadcrumb bg-light p-2 rounded">
            <li class="breadcrumb-item">{{ 'GRUPO_CITAS' | translate }}</li>
            <li class="breadcrumb-item active">{{ 'APPOINTMENTS.LIST_DOCTORS.BREADCRUMB' | translate }}</li>
          </ol>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12">
        <div class="card card-list shadow border-0">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start flex-wrap mb-3 header-bar">
              <h4 class="mb-0 fw-semibold">{{ 'APPOINTMENTS.LIST_DOCTORS.TITLE' | translate }}</h4>
              <div class="filter-controls-wrapper">
                <div class="filters-section d-flex gap-2 mb-2">
                  <div class="search-box">
                    <input type="text" class="form-control white-input"
                      [placeholder]="'APPOINTMENTS.LIST_DOCTORS.SEARCH_PLACEHOLDER' | translate"
                      [(ngModel)]="searchTerm" (ngModelChange)="filterDoctors()">
                    <i class="fa fa-search search-icon"></i>
                  </div>
                  <!-- Filtro Especialidad -->
                  <div class="role-filter-box" *ngIf="showSpecialist">
                    <select class="form-select white-select" [(ngModel)]="filtroEspecialidad"
                      (ngModelChange)="filterDoctors()">
                      <option value="">{{ 'APPOINTMENTS.LIST_DOCTORS.ALL_SPECIALTIES' | translate }}</option>
                      <option *ngFor="let esp of especialidades" [value]="esp.id">{{ esp.nombre }}</option>
                    </select>
                  </div>

                  <!-- Filtro General Medical -->
                  <div class="role-filter-box" *ngIf="showGeneral">
                    <select class="form-select white-select" [(ngModel)]="filtroGeneralMedical"
                      (ngModelChange)="filterDoctors()">
                      <option value="">{{ 'APPOINTMENTS.ADD_APPOINTMENT.GENERAL_MEDICAL' | translate }} (Todas)</option>
                      <option *ngFor="let gm of generalMedicals" [value]="gm.id">{{ gm.nombre }}</option>
                    </select>
                  </div>
                </div>
                <a [routerLink]="['/appointments/add_doctor']" class="btn btn-options d-flex align-items-center gap-1">
                  <i class="fa fa-plus"></i> <span class="d-none d-sm-inline">{{ 'APPOINTMENTS.LIST_DOCTORS.ADD_DOCTOR'
                    | translate }}</span>
                </a>
              </div>
            </div>
            <div class="table-responsive">
              <table class="table table-hover align-middle modern-table">
                <thead class="table-light">
                  <tr>
                    <th style="width: 30%;"><i class="fa fa-user-md me-2"></i>{{ 'APPOINTMENTS.LIST_DOCTORS.NAME' |
                      translate }}</th>
                    <th style="width: 20%;"><i class="fa fa-stethoscope me-2"></i>{{
                      'APPOINTMENTS.LIST_DOCTORS.SPECIALTY' | translate }}</th>
                    <th style="width: 15%;"><i class="fa fa-clock me-2"></i>{{ 'APPOINTMENTS.LIST_DOCTORS.SHIFT' |
                      translate }}</th>
                    <th style="width: 20%;"><i class="fa fa-calendar-alt me-2"></i>{{
                      'APPOINTMENTS.LIST_DOCTORS.SCHEDULE' | translate }}</th>
                    <th style="width: 15%;" class="text-center"><i class="fa fa-cog me-2"></i>{{
                      'APPOINTMENTS.LIST_DOCTORS.ACTIONS' | translate }}</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngIf="isLoading">
                    <td colspan="5" class="text-center py-5">
                      <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">{{ 'COMMON.LOADING' | translate }}...</span>
                      </div>
                      <p class="mt-2 text-muted">{{ 'COMMON.LOADING' | translate }}...</p>
                    </td>
                  </tr>
                  <tr *ngIf="!isLoading && filteredDoctors.length === 0">
                    <td colspan="5" class="text-center py-5">
                      <i class="fa fa-user-md fa-3x text-muted mb-3"></i>
                      <p class="text-muted">{{ 'APPOINTMENTS.LIST_DOCTORS.NO_DOCTORS' | translate }}</p>
                    </td>
                  </tr>
                  <tr *ngFor="let doctor of filteredDoctors.slice(skip, skip + limit); let i = index">
                    <td>
                      <div class="user-name-cell">
                        <i class="fa fa-user-circle text-primary me-2"></i>
                        <strong>{{ doctor.nombre_completo }}</strong>
                      </div>
                    </td>
                    <td>
                      <div class="specialty-cell">
                        <span class="badge badge-role">
                          <i class="fa fa-stethoscope me-1"></i>
                          {{ getRoleName(doctor) }}
                        </span>
                      </div>
                    </td>
                    <td>
                      <div class="shift-cell">
                        <span class="badge"
                          [ngClass]="{'bg-success': doctor.turno === 'Matutino', 'bg-primary': doctor.turno === 'Vespertino', 'bg-info': doctor.turno === 'Mixto'}">
                          <i class="fa fa-sun me-1" *ngIf="doctor.turno === 'Matutino'"></i>
                          <i class="fa fa-moon me-1" *ngIf="doctor.turno === 'Vespertino'"></i>
                          <i class="fa fa-adjust me-1" *ngIf="doctor.turno === 'Mixto'"></i>
                          {{ doctor.turno }}
                        </span>
                      </div>
                    </td>
                    <td>
                      <div class="schedule-cell">
                        <small class="text-muted">
                          <i class="fa fa-clock me-1"></i>
                          {{ getSchedule(doctor) }}
                        </small>
                      </div>
                    </td>
                    <td class="text-center">
                      <div class="action-buttons">
                        <button class="btn btn-sm btn-edit" [routerLink]="['/appointments/edit_doctor/', doctor.id]"
                          [title]="'APPOINTMENTS.LIST_DOCTORS.EDIT' | translate">
                          <i class="fa fa-pen"></i>
                        </button>
                        <button class="btn btn-sm btn-delete" (click)="selectDoctor(doctor)" data-bs-toggle="modal"
                          data-bs-target="#deleteModal" [title]="'APPOINTMENTS.LIST_DOCTORS.DELETE' | translate">
                          <i class="fa fa-trash"></i>
                        </button>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <!-- Sección de paginación -->
            <div class="d-flex justify-content-between align-items-center mt-3 flex-wrap">
              <div class="pagination-info small">
                <!-- Información de registros mostrados -->
                {{ 'APPOINTMENTS.LIST_DOCTORS.SHOWING' | translate }} {{ serialNumberArray[0] || 0 }} {{
                'APPOINTMENTS.LIST_DOCTORS.TO' | translate }} {{ serialNumberArray[serialNumberArray.length - 1] || 0 }}
                {{ 'APPOINTMENTS.LIST_DOCTORS.OF' | translate }} {{ totalData }} {{ 'APPOINTMENTS.LIST_DOCTORS.RECORDS'
                | translate }}
              </div>
              <nav>
                <ul class="pagination mb-0">
                  <!-- Botón para página anterior -->
                  <li class="page-item" [class.disabled]="currentPage === 1">
                    <a class="page-link" href="javascript:void(0);" (click)="getMoreData('previous')">{{
                      'APPOINTMENTS.LIST_DOCTORS.PREVIOUS' | translate }}</a>
                  </li>
                  <!-- Botones para cada página -->
                  <ng-container *ngFor="let item of pageNumberArray">
                    <li class="page-item" [class.active]="item === currentPage">
                      <a class="page-link" href="javascript:void(0);" (click)="moveToPage(item)">{{ item }}</a>
                    </li>
                  </ng-container>
                  <!-- Botón para página siguiente -->
                  <li class="page-item" [class.disabled]="currentPage === pageNumberArray[pageNumberArray.length - 1]">
                    <a class="page-link" href="javascript:void(0);" (click)="getMoreData('next')">{{
                      'APPOINTMENTS.LIST_DOCTORS.NEXT' | translate }}</a>
                  </li>
                </ul>
              </nav>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="deleteModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header border-0">
        <h5 class="modal-title"><i class="fa fa-exclamation-triangle text-warning me-2"></i>{{
          'APPOINTMENTS.LIST_DOCTORS.CONFIRM_DELETE' | translate }}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p>{{ 'APPOINTMENTS.LIST_DOCTORS.DELETE_CONFIRMATION' | translate }}</p>
        <div class="alert alert-warning d-flex align-items-center" *ngIf="selectedDoctor">
          <i class="fa fa-user-md fa-2x me-3"></i>
          <div>
            <strong>{{ selectedDoctor.nombre_completo }}</strong><br>
            <small class="text-muted">{{ selectedDoctor.especialidad?.nombre }}</small>
          </div>
        </div>
        <p class="text-danger small mb-0"><i class="fa fa-exclamation-circle me-1"></i>{{
          'APPOINTMENTS.LIST_DOCTORS.DELETE_WARNING' | translate }}</p>
      </div>
      <div class="modal-footer border-0">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"><i class="fa fa-times me-1"></i>{{
          'COMMON.CANCEL' | translate }}</button>
        <button type="button" class="btn btn-danger" (click)="confirmDelete()" data-bs-dismiss="modal"><i
            class="fa fa-trash me-1"></i>{{ 'APPOINTMENTS.LIST_DOCTORS.DELETE' | translate }}</button>
      </div>
    </div>
  </div>
</div>

<!-- Botón flotante de ayuda para iniciar el tour -->
<button class="tour-help-button" (click)="startTour()" title="{{ 'TOUR.HELP_BUTTON' | translate }}" type="button">
  <i class="fa fa-question"></i>
</button>